<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="Content-Type" content="text/html;charset=gb2312">
  <title>华电二手物品后台管理</title>
  <link rel="stylesheet" href="/huadian/html/layui/css/layui.css">
  <link rel="stylesheet" href="/huadian/html/css/manage.css">
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
  <div class="layui-header">
    <div class="layui-logo" style="color:#FF5722">华电二手物品交易平台</div>
    <!-- 头部区域（可配合layui已有的水平导航） -->
    <ul class="layui-nav layui-layout-left">
      <li class="layui-nav-item">
      	<a href="/huadian/html/manage_user.html">用户管理</a>
      </li>
      <li class="layui-nav-item">
      	<a href="javascript:void(0);">商品管理</a>
      	<dl class="layui-nav-child">
      		<dd><a href="/huadian/html/manage_goodsClass.html">商品种类管理</a></dd>
      		<dd><a href="javascript:void(0);">商品管理</a></dd>
      	</dl>
      </li>
    </ul>
    <ul class="layui-nav layui-layout-right">
      <li class="layui-nav-item">
        <a href="javascript:;">
          <img src="/huadian/html/layui/images/face/0.gif" class="layui-nav-img">
          <span id="managerName"></span>
        </a>
        <dl class="layui-nav-child">
          <dd><a href="javascript:void(0);" id="info">基本资料</a></dd>
          <dd><a href="javascript:void(0);" id="updateInfo">修改密码</a></dd>
        </dl>
      </li>
      <li class="layui-nav-item"><a id="logout" href="javascript:void(0);">退出</a></li>
    </ul>
  </div>
  
  <div class="layui-side layui-bg-black">
    <div class="layui-side-scroll">
      <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
      <ul class="layui-nav layui-nav-tree"  lay-filter="test">
        <li class="layui-nav-item layui-nav-itemed">
          <a class="" href="javascript:;">所有商品</a>
          <dl class="layui-nav-child">
            <dd><a href="javascript:;">列表一</a></dd>
            <dd><a href="javascript:;">列表二</a></dd>
            <dd><a href="javascript:;">列表三</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item"><a href="">发布商品</a></li>
      </ul>
    </div>
  </div>
  
  <div class="layui-body">
    <!-- 内容主体区域 -->
    <div style="padding: 15px;">
    	<h2 style="text-align: center;color: #666;position: relative;bottom: 5px;">
    		华电二手交易平台用户表
    		<a href="javascript:void(0);" id="addUser" class="layui-btn" style="position: absolute;right: 0;">新增用户</a>
    	</h2>
    	<table class="layui-hide" id="admin" lay-filter="demo"></table>
    	<script type="text/html" id="operation-bar">
  			<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
  			<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
		</script>
    </div>
  </div>
  
  <div class="layui-footer">
    <!-- 底部固定区域 -->
    © huadian.com - 底部固定区域
  </div>
</div>
<script type="text/html" id="update">
<form action="" class="layui-form">
	<div class="layui-form-item">
		<label class="layui-form-label">当前密码</label>
		<div class="layui-input-block">
			<input type="password" required lay-verify="required|pass" minlength="6" maxlength="16"   name="old_password" class="layui-input form-item-input" autocomplete="off" placeholder="请输入旧密码">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">新密码</label>
		<div class="layui-input-block">
			<input type="password" required lay-verify="required|pass" minlength="6" maxlength="16" name="new_password" class="layui-input form-item-input" autocomplete="off" placeholder="请输入新密码">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">确认新密码</label>
		<div class="layui-input-block">
			<input type="password" required lay-verify="required|pass" minlength="6" maxlength="16"  name="renew_password" class="layui-input form-item-input" autocomplete="off" placeholder="请再次输入新密码">
		</div>
	</div>	
		<div class="layui-form-item">
		<div class="layui-input-block">
			<button class="layui-btn" lay-submit lay-filter="update">立即更新</button>
		</div>
	</div>
</form>
</script>
<script type="text/html" id="updateUsers">
	<form action="" class="layui-form" id="update_users">
	<div class="layui-form-item">
		<label class="layui-form-label">用户名</label>
		<div class="layui-input-block">
			<input type="text" required lay-verify="required|username" maxlength="10"   name="name" class="layui-input form-item-input" autocomplete="off" placeholder="请输入用户名">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">密码</label>
		<div class="layui-input-block">
			<input type="password" required lay-verify="required|pass" minlength="6" maxlength="15" name="password" class="layui-input form-item-input" autocomplete="off" placeholder="请输入密码">
		</div>
	</div>
	<input type="hidden" name="id">
	<div class="layui-form-item">
		<div class="layui-input-block">
			<button class="layui-btn" lay-submit lay-filter="update_users">立即更新</button>
		</div>
	</div>	
</form>
</script>
<script type="text/html" id="addUsers">
	<form action="" class="layui-form" id="add_users">
	<div class="layui-form-item">
		<label class="layui-form-label">用户名</label>
		<div class="layui-input-block">
			<input type="text" required lay-verify="required|username" maxlength="10"   name="name" class="layui-input form-item-input" autocomplete="off" placeholder="请输入用户名">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">密码</label>
		<div class="layui-input-block">
			<input type="password" required lay-verify="required|pass" minlength="6" maxlength="16" name="password" class="layui-input form-item-input" autocomplete="off" placeholder="请输入密码">
		</div>
	</div>
	<div class="layui-form-item">
		<div class="layui-input-block">
			<button class="layui-btn" lay-submit lay-filter="add_users">立即添加</button>
		</div>
	</div>	
</form>
</script>
<script src="/huadian/html/js/jquery-1.11.3.min.js"></script>
<script src="/huadian/html/layui/layui.js"></script>
<script src="/huadian/html/js/update.js" charset="gb2312" type="text/javascript"></script>
<script src="/huadian/html/js/admin.js" charset="gb2312" type="text/javascript"></script>
<script>
//JavaScript代码区域
layui.use(['element','layer','form'], function(){
	var form=layui.form;
	var layer_manager_update;
	
	form.verify({
     	  username: function(value, item){ //value：表单的值、item：表单的DOM对象
     	    if(!new RegExp("^[a-zA-Z0-9_\u4e00-\u9fa5\\s·]+$").test(value)){
     	      return '用户名不能有特殊字符';
     	    }
     	    if(/(^\_)|(\__)|(\_+$)/.test(value)){
     	      return '用户名首尾不能出现下划线\'_\'';
     	    }
     	    if(/^\d+\d+\d$/.test(value)){
     	      return '用户名不能全为数字';
     	    }
     	  }
     	  
     	  //我们既支持上述函数式的方式，也支持下述数组的形式
     	  //数组的两个值分别代表：[正则匹配、匹配不符时的提示文字]
     	  ,pass: [
     	    /^[\S]{6,15}$/
     	    ,'密码必须6到15位，且不能出现空格'
     	  ]
    });   
	
	form.on("submit(update)",function(data){
		base_ajax(base_index,data.field,function(){
			//return false;
			layer.close(layer_manager_update);
		});
		return false;
	});
	$(document).on('click','#logout',function(){
		layer.confirm('确认退出吗？',{
			btn:['确认','取消']//按钮
		},function(){
			window.location.href="/huadian/servlet/Logout";
			layer.msg("退出成功!");
		});
	});
	
	
	$(document).on('click','#updateInfo',function(){
		layer_manager_update=layer.open({
			type:1,
			title:['管理员密码-修改','font-size:13px;margin-top:10px'],
			content:$('#update').html(),
		});
	});
});
var url='http://localhost:8080/huadian/servlet/Manager';

var getSession=function(){
	$.ajax({
		url: url,
        type: "post",
        dataType : "json",
        success: function(data){
            console.log(data);
            if(data.managerName!=""){
            	$("#managerName").html(localStorage.getItem("managerName"));
            }else{
            	window.location.href="/huadian/html/managerLogin.html";
            }
           	},
           	error: function (XMLHttpRequest, textStatus, errorThrown) {
	            return false;
        },
        complete: function (XMLHttpRequest, textStatus) {
            this;
        }
	});
	}
	getSession();
</script>
</body>
</html>